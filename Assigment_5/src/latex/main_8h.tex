\hypertarget{main_8h}{}\doxysection{main.\+h File Reference}
\label{main_8h}\index{main.h@{main.h}}


Application to control the light intensity of a given region. The system comprises a light sensor, an illumination system and a Human-\/\+Machine Interface. The system can operate in two modes\+: • Automatic\+: programmable via the terminal. Should allow setting On/\+Off periods and the corresponding light intensity; • Manual\+: interface via the Dev\+Kit buttons. Allows to turn the system On/\+Off (when in “\+Off” the system operates in automatic mode), via two of the buttons. The other two buttons allow to set (increase/decrease) the desired intensity.  


\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8h_a6288eba0f8e8ad3ab1544ad731eb7667}{main}} (void)
\begin{DoxyCompactList}\small\item\em Main funtion\+: Initialize semaphores and configure G\+P\+I\+O\+\_\+\+P\+IN. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a61675a61bbec86901b2fe28f008e881c}{thread\+\_\+\+A\+\_\+code}} (void $\ast$argA, void $\ast$argB, void $\ast$argC)
\begin{DoxyCompactList}\small\item\em Lê o botao 1, faz o toggle entre o manual e o automatico, sendo periódico. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a7e3fa2c87f08ae9cfff992653a3ac0b6}{thread\+\_\+\+A1\+\_\+code}} (void $\ast$argA, void $\ast$argB, void $\ast$argC)
\item 
void \mbox{\hyperlink{main_8h_a99cef2c8673e9c73162dd97f0247ca8e}{thread\+\_\+\+B\+\_\+code}} (void $\ast$argA, void $\ast$argB, void $\ast$argC)
\begin{DoxyCompactList}\small\item\em É efectuada a filtragem, em que é realizado a média das últimas 10 amostras calculadas na Thread A e o filtro rejeita todos os valores que estejam abaixo ou acima de 10\% da média. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a6eec62f04743b40b6d744ecd2f31cdd2}{thread\+\_\+\+C\+\_\+code}} (void $\ast$argA, void $\ast$argB, void $\ast$argC)
\begin{DoxyCompactList}\small\item\em Modo manual, onde se faz o toggle sempre que carregar no botão 2 incrementa a luminosidade, ao clicar no botão 4 a luminosidade decrementa, ou seja, diminui a percentagem do P\+WM, quando está a 100\% está no maximo e o duty-\/cycle corresponde é de 0\%, que é quando está no máximo, e assim succesivamente. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_a66dec4e923ae4b8177536366d462a1cd}{thread\+\_\+\+D\+\_\+code}} (void $\ast$argA, void $\ast$argB, void $\ast$argC) static int adc\+\_\+sample(void)
\begin{DoxyCompactList}\small\item\em Modo automático\+: Recebe o valor da A\+DC e faz o take que vem do bd (após a filtragem); Se o valor for menor que 500, o led está apagado, ou seja, é detetada muita luminiosidade logo; Quando estamos à luz ambiente o led está com a luminiosidade a meio; Se não existir luminiosidade o led acede. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_ae7d90a3db3be4d74a95d59cb9bc36764}{but1press\+\_\+cbfunction}} (const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins)
\begin{DoxyCompactList}\small\item\em If button 1 is pressed, Update Flag 1. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_ad5a577fea0419d075e8b4de7c1416f9b}{but2press\+\_\+cbfunction}} (const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins)
\begin{DoxyCompactList}\small\item\em If button 2 is pressed, Update Flag 2. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8h_ad98aaf56309e1b0b996d247f18b73b0e}{but4press\+\_\+cbfunction}} (const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins)
\begin{DoxyCompactList}\small\item\em If button 4 is pressed, Update Flag 4. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Application to control the light intensity of a given region. The system comprises a light sensor, an illumination system and a Human-\/\+Machine Interface. The system can operate in two modes\+: • Automatic\+: programmable via the terminal. Should allow setting On/\+Off periods and the corresponding light intensity; • Manual\+: interface via the Dev\+Kit buttons. Allows to turn the system On/\+Off (when in “\+Off” the system operates in automatic mode), via two of the buttons. The other two buttons allow to set (increase/decrease) the desired intensity. 

\begin{DoxyAuthor}{Author}
Frederico Moreira, Ana Sousa, Pedro Rodrigues 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
21 June 2022 
\end{DoxyDate}
\begin{DoxyRefDesc}{Bug}
\item[\mbox{\hyperlink{bug__bug000001}{Bug}}]No known bugs.\end{DoxyRefDesc}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{main_8h_ae7d90a3db3be4d74a95d59cb9bc36764}\label{main_8h_ae7d90a3db3be4d74a95d59cb9bc36764}} 
\index{main.h@{main.h}!but1press\_cbfunction@{but1press\_cbfunction}}
\index{but1press\_cbfunction@{but1press\_cbfunction}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{but1press\_cbfunction()}{but1press\_cbfunction()}}
{\footnotesize\ttfamily void but1press\+\_\+cbfunction (\begin{DoxyParamCaption}\item[{const struct device $\ast$}]{dev,  }\item[{struct gpio\+\_\+callback $\ast$}]{cb,  }\item[{uint32\+\_\+t}]{pins }\end{DoxyParamCaption})}



If button 1 is pressed, Update Flag 1. 


\begin{DoxyCode}{0}
\DoxyCodeLine{  \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_ae7d90a3db3be4d74a95d59cb9bc36764}{but1press\_cbfunction}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} device *dev, \textcolor{keyword}{struct} gpio\_callback *cb, uint32\_t pins)}
\DoxyCodeLine{\{ }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a1b93c31a3a5406a58cf35e15fdfe4cfa}{Flag\_1}} = 1;}
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a83a05746f11a28eb3b63c6a34f02b6b0}{flag\_flag}}=!\mbox{\hyperlink{main_8c_a83a05746f11a28eb3b63c6a34f02b6b0}{flag\_flag}};}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"but1 \(\backslash\)n\(\backslash\)r"});}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
\mbox{\Hypertarget{main_8h_ad5a577fea0419d075e8b4de7c1416f9b}\label{main_8h_ad5a577fea0419d075e8b4de7c1416f9b}} 
\index{main.h@{main.h}!but2press\_cbfunction@{but2press\_cbfunction}}
\index{but2press\_cbfunction@{but2press\_cbfunction}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{but2press\_cbfunction()}{but2press\_cbfunction()}}
{\footnotesize\ttfamily void but2press\+\_\+cbfunction (\begin{DoxyParamCaption}\item[{const struct device $\ast$}]{dev,  }\item[{struct gpio\+\_\+callback $\ast$}]{cb,  }\item[{uint32\+\_\+t}]{pins }\end{DoxyParamCaption})}



If button 2 is pressed, Update Flag 2. 


\begin{DoxyCode}{0}
\DoxyCodeLine{ \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_ae7d90a3db3be4d74a95d59cb9bc36764}{but1press\_cbfunction}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} device *dev, \textcolor{keyword}{struct} gpio\_callback *cb, uint32\_t pins)}
\DoxyCodeLine{\{   }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a925968d5fb460a21c13cb8917784b98f}{Flag\_2}} = 1;}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
\mbox{\Hypertarget{main_8h_ad98aaf56309e1b0b996d247f18b73b0e}\label{main_8h_ad98aaf56309e1b0b996d247f18b73b0e}} 
\index{main.h@{main.h}!but4press\_cbfunction@{but4press\_cbfunction}}
\index{but4press\_cbfunction@{but4press\_cbfunction}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{but4press\_cbfunction()}{but4press\_cbfunction()}}
{\footnotesize\ttfamily void but4press\+\_\+cbfunction (\begin{DoxyParamCaption}\item[{const struct device $\ast$}]{dev,  }\item[{struct gpio\+\_\+callback $\ast$}]{cb,  }\item[{uint32\+\_\+t}]{pins }\end{DoxyParamCaption})}



If button 4 is pressed, Update Flag 4. 


\begin{DoxyCode}{0}
\DoxyCodeLine{ \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_ae7d90a3db3be4d74a95d59cb9bc36764}{but1press\_cbfunction}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} device *dev, \textcolor{keyword}{struct} gpio\_callback *cb, uint32\_t pins)}
\DoxyCodeLine{\{ }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a9797c6a281fed7356c07f50a6727bd88}{Flag\_4}} = 1;}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & const struct device $\ast$dev, struct gpio\+\_\+callback $\ast$cb, uint32\+\_\+t pins. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
\mbox{\Hypertarget{main_8h_a6288eba0f8e8ad3ab1544ad731eb7667}\label{main_8h_a6288eba0f8e8ad3ab1544ad731eb7667}} 
\index{main.h@{main.h}!main@{main}}
\index{main@{main}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily void main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Main funtion\+: Initialize semaphores and configure G\+P\+I\+O\+\_\+\+P\+IN. 


\begin{DoxyCode}{0}
\DoxyCodeLine{ \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a6288eba0f8e8ad3ab1544ad731eb7667}{main}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{  \textcolor{keywordtype}{int} err=0;    }
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{    printf(\textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)r Illustration of the use of shmem + semaphores\(\backslash\)n\(\backslash\)r"});}
\DoxyCodeLine{    \textcolor{keywordtype}{int} ret = 0;}
\DoxyCodeLine{    ret = gpio\_pin\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_ad3c05b8933cd253785fdd123f6dbfc18}{BOARDBUT1}}, GPIO\_INPUT | GPIO\_PULL\_UP);}
\DoxyCodeLine{    ret = gpio\_pin\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_a590d906828bd5948fafbef47dc1c3b0c}{BOARDBUT2}}, GPIO\_INPUT | GPIO\_PULL\_UP);}
\DoxyCodeLine{    ret = gpio\_pin\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_abee96e1280405ff973ee2b6b07eec104}{BOARDBUT4}}, GPIO\_INPUT | GPIO\_PULL\_UP);}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (ret < 0) \{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Error \%d: Failed to configure BUT 1 \(\backslash\)r"}, ret);}
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    ret = gpio\_pin\_interrupt\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_ad3c05b8933cd253785fdd123f6dbfc18}{BOARDBUT1}}, GPIO\_INT\_EDGE\_TO\_ACTIVE);}
\DoxyCodeLine{    ret = gpio\_pin\_interrupt\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_a590d906828bd5948fafbef47dc1c3b0c}{BOARDBUT2}}, GPIO\_INT\_EDGE\_TO\_ACTIVE);}
\DoxyCodeLine{    ret = gpio\_pin\_interrupt\_configure(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \mbox{\hyperlink{main_8c_abee96e1280405ff973ee2b6b07eec104}{BOARDBUT4}}, GPIO\_INT\_EDGE\_TO\_ACTIVE);}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (ret != 0) \{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Error \%d: failed to configure interrupt on BUT1 pin \(\backslash\)r"}, ret);}
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{}
\DoxyCodeLine{    gpio\_init\_callback(\&but1\_cb\_data, \mbox{\hyperlink{main_8c_ae7d90a3db3be4d74a95d59cb9bc36764}{but1press\_cbfunction}}, BIT(\mbox{\hyperlink{main_8c_ad3c05b8933cd253785fdd123f6dbfc18}{BOARDBUT1}}));}
\DoxyCodeLine{    gpio\_add\_callback(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \&but1\_cb\_data);}
\DoxyCodeLine{}
\DoxyCodeLine{    gpio\_init\_callback(\&but2\_cb\_data, \mbox{\hyperlink{main_8c_ad5a577fea0419d075e8b4de7c1416f9b}{but2press\_cbfunction}}, BIT(\mbox{\hyperlink{main_8c_a590d906828bd5948fafbef47dc1c3b0c}{BOARDBUT2}}));}
\DoxyCodeLine{    gpio\_add\_callback(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \&but2\_cb\_data);}
\DoxyCodeLine{}
\DoxyCodeLine{    gpio\_init\_callback(\&but4\_cb\_data, \mbox{\hyperlink{main_8c_ad98aaf56309e1b0b996d247f18b73b0e}{but4press\_cbfunction}}, BIT(\mbox{\hyperlink{main_8c_abee96e1280405ff973ee2b6b07eec104}{BOARDBUT4}}));}
\DoxyCodeLine{    gpio\_add\_callback(\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}}, \&but4\_cb\_data);}
\DoxyCodeLine{  }
\DoxyCodeLine{      }
\DoxyCodeLine{    err=0;}
\DoxyCodeLine{    uint8\_t \mbox{\hyperlink{main_8c_aa10d925c769d61749a2c03cbc08accf9}{welcome\_mesg}}[] = \textcolor{stringliteral}{"UART demo: Type a few chars in a row and then pause for a little while ...\(\backslash\)n\(\backslash\)r"}; }
\DoxyCodeLine{    uint8\_t \mbox{\hyperlink{main_8c_a3a480200b92d24ef74a3d1673fe80352}{rep\_mesg}}[\mbox{\hyperlink{main_8c_a923af2d146f214e75816a7f5993cee29}{TXBUF\_SIZE}}];}
\DoxyCodeLine{}
\DoxyCodeLine{ }
\DoxyCodeLine{    }
\DoxyCodeLine{    k\_sem\_init(\&\mbox{\hyperlink{main_8c_a694d4d09f94a0fa64224f38ced19a053}{sem\_a1a}}, 0, 1);}
\DoxyCodeLine{    k\_sem\_init(\&\mbox{\hyperlink{main_8c_a82e13125c2f279157fcf738219ff21ba}{sem\_ab}}, 0, 1);}
\DoxyCodeLine{    k\_sem\_init(\&\mbox{\hyperlink{main_8c_addc907d18e7e98a64a832ac1c7be5ad1}{sem\_bc}}, 0, 1);}
\DoxyCodeLine{     k\_sem\_init(\&\mbox{\hyperlink{main_8c_a87cd814a87f494b060e8c0903fc0068f}{sem\_bd}}, 0, 1);}
\DoxyCodeLine{    }
\DoxyCodeLine{    }
\DoxyCodeLine{     \mbox{\hyperlink{main_8c_a65e8d83f25fef7705df61d0ba2e7aeed}{thread\_A1\_tid}} = k\_thread\_create(\&\mbox{\hyperlink{main_8c_a9458f0d62ec1f293b70003f545ef3736}{thread\_A1\_data}}, thread\_A1\_stack,}
\DoxyCodeLine{        K\_THREAD\_STACK\_SIZEOF(thread\_A1\_stack), \mbox{\hyperlink{main_8c_a7e3fa2c87f08ae9cfff992653a3ac0b6}{thread\_A1\_code}},}
\DoxyCodeLine{        NULL, NULL, NULL, \mbox{\hyperlink{main_8c_a746ccc18867d1114f9ea5144c5dfb59e}{thread\_A1\_prio}}, 0, K\_NO\_WAIT);}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_aaac68d6bd12397c115c8f5fb8b8dae16}{thread\_A\_tid}} = k\_thread\_create(\&\mbox{\hyperlink{main_8c_a6d4412666e45fbd3d7bb2e537e3e4921}{thread\_A\_data}}, thread\_A\_stack,}
\DoxyCodeLine{        K\_THREAD\_STACK\_SIZEOF(thread\_A\_stack), \mbox{\hyperlink{main_8c_a61675a61bbec86901b2fe28f008e881c}{thread\_A\_code}},}
\DoxyCodeLine{        NULL, NULL, NULL, \mbox{\hyperlink{main_8c_a5936222e9802dbe8ceb1e99bd667466a}{thread\_A\_prio}}, 0, K\_NO\_WAIT);}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_af2bd9deb85bd5ac0cdf3a0b077411289}{thread\_B\_tid}} = k\_thread\_create(\&\mbox{\hyperlink{main_8c_ad832c1a3de4a77b89216efc38eddcb72}{thread\_B\_data}}, thread\_B\_stack,}
\DoxyCodeLine{        K\_THREAD\_STACK\_SIZEOF(thread\_B\_stack), \mbox{\hyperlink{main_8c_a99cef2c8673e9c73162dd97f0247ca8e}{thread\_B\_code}},}
\DoxyCodeLine{        NULL, NULL, NULL, \mbox{\hyperlink{main_8c_aa9928aa4491a20c74a19c5904ba9530a}{thread\_B\_prio}}, 0, K\_NO\_WAIT);}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a3e9a231be3f7d1a28871ddfdf5ca8fe3}{thread\_C\_tid}} = k\_thread\_create(\&\mbox{\hyperlink{main_8c_a9723f8aa3cfd56015ee57bc31879f8ec}{thread\_C\_data}}, thread\_C\_stack,}
\DoxyCodeLine{        K\_THREAD\_STACK\_SIZEOF(thread\_C\_stack), \mbox{\hyperlink{main_8c_a6eec62f04743b40b6d744ecd2f31cdd2}{thread\_C\_code}},}
\DoxyCodeLine{        NULL, NULL, NULL, \mbox{\hyperlink{main_8c_a1bd72aae8d0dd6e887547a1d5e0a8902}{thread\_C\_prio}}, 0, K\_NO\_WAIT);}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_ae130441eb06f8e1d532010c32c8fd15c}{thread\_D\_tid}} = k\_thread\_create(\&\mbox{\hyperlink{main_8c_a91a7abf451804f293c55d5fc507cee31}{thread\_D\_data}}, thread\_D\_stack,}
\DoxyCodeLine{        K\_THREAD\_STACK\_SIZEOF(thread\_D\_stack), \mbox{\hyperlink{main_8c_a1a621f0dfdf57a438495482f571278e7}{thread\_D\_code}},}
\DoxyCodeLine{        NULL, NULL, NULL, \mbox{\hyperlink{main_8c_a02433a30dac2e9bc252089790fc081e3}{thread\_D\_prio}}, 0, K\_NO\_WAIT);}
\DoxyCodeLine{}
\DoxyCodeLine{     }
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{\}     }
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em N\+O\+\_\+args} & without arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
Welcome message

Create and init semaphores

Create tasks\mbox{\Hypertarget{main_8h_a7e3fa2c87f08ae9cfff992653a3ac0b6}\label{main_8h_a7e3fa2c87f08ae9cfff992653a3ac0b6}} 
\index{main.h@{main.h}!thread\_A1\_code@{thread\_A1\_code}}
\index{thread\_A1\_code@{thread\_A1\_code}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{thread\_A1\_code()}{thread\_A1\_code()}}
{\footnotesize\ttfamily void thread\+\_\+\+A1\+\_\+code (\begin{DoxyParamCaption}\item[{void $\ast$}]{argA,  }\item[{void $\ast$}]{argB,  }\item[{void $\ast$}]{argC }\end{DoxyParamCaption})}

Lê o valor da A\+DC e guarda numa variável global (shared memory between tasks A/B) no nosso Código denominada por “ab” e no final faz give do semáforo AB. É o valor da A\+DC que é guardado numa variável global (shared memory between tasks A/B) no nosso Código denominada por “ab” e no final faz give do semáforo AB. 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a7e3fa2c87f08ae9cfff992653a3ac0b6}{thread\_A1\_code}}(\textcolor{keywordtype}{void} *argA , \textcolor{keywordtype}{void} *argB, \textcolor{keywordtype}{void} *argC)}
\DoxyCodeLine{\{}
\DoxyCodeLine{    }
\DoxyCodeLine{    int64\_t fin\_time=0, release\_time=0;}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} err=0;}
\DoxyCodeLine{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Thread A1 init (periodic)\(\backslash\)n"});}
\DoxyCodeLine{}
\DoxyCodeLine{    }
\DoxyCodeLine{    release\_time = k\_uptime\_get() + \mbox{\hyperlink{main_8c_a7829e7c5c37ea8a78e879aa2028dfb21}{SAMP\_PERIOD\_MS}};}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{while}(1) \{}
\DoxyCodeLine{        }
\DoxyCodeLine{  }
\DoxyCodeLine{        \textcolor{keywordflow}{if} (\mbox{\hyperlink{main_8c_a83a05746f11a28eb3b63c6a34f02b6b0}{flag\_flag}}==0)\{}
\DoxyCodeLine{         printk(\textcolor{stringliteral}{"Modo manual\(\backslash\)n"});}
\DoxyCodeLine{         printk(\textcolor{stringliteral}{"Modo key 2 e 4\(\backslash\)n"});}
\DoxyCodeLine{         k\_sem\_give(\&\mbox{\hyperlink{main_8c_addc907d18e7e98a64a832ac1c7be5ad1}{sem\_bc}});\}}
\DoxyCodeLine{        }
\DoxyCodeLine{        \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{       }
\DoxyCodeLine{           printk(\textcolor{stringliteral}{"Modo automatico\(\backslash\)n"});}
\DoxyCodeLine{ }
\DoxyCodeLine{          k\_sem\_give(\&\mbox{\hyperlink{main_8c_a694d4d09f94a0fa64224f38ced19a053}{sem\_a1a}});}
\DoxyCodeLine{          \}}
\DoxyCodeLine{}
\DoxyCodeLine{        fin\_time = k\_uptime\_get();}
\DoxyCodeLine{        \textcolor{keywordflow}{if}( fin\_time < release\_time) \{        }
\DoxyCodeLine{            k\_msleep(release\_time -\/ fin\_time);            }
\DoxyCodeLine{            release\_time += \mbox{\hyperlink{main_8c_a7829e7c5c37ea8a78e879aa2028dfb21}{SAMP\_PERIOD\_MS}};}
\DoxyCodeLine{        \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    }
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & void $\ast$argA , void $\ast$argB, void $\ast$argC. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns ~\newline

\end{DoxyReturn}
Thread code prototypes \mbox{\Hypertarget{main_8h_a61675a61bbec86901b2fe28f008e881c}\label{main_8h_a61675a61bbec86901b2fe28f008e881c}} 
\index{main.h@{main.h}!thread\_A\_code@{thread\_A\_code}}
\index{thread\_A\_code@{thread\_A\_code}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{thread\_A\_code()}{thread\_A\_code()}}
{\footnotesize\ttfamily void thread\+\_\+\+A\+\_\+code (\begin{DoxyParamCaption}\item[{void $\ast$}]{argA,  }\item[{void $\ast$}]{argB,  }\item[{void $\ast$}]{argC }\end{DoxyParamCaption})}



Lê o botao 1, faz o toggle entre o manual e o automatico, sendo periódico. 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a61675a61bbec86901b2fe28f008e881c}{thread\_A\_code}}(\textcolor{keywordtype}{void} *argA , \textcolor{keywordtype}{void} *argB, \textcolor{keywordtype}{void} *argC)}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} err=0;}
\DoxyCodeLine{    }
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Thread A init\(\backslash\)n"});}
\DoxyCodeLine{       }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_a445f79326d40128ece59a749adff6894}{adc\_dev}} = device\_get\_binding(DT\_LABEL(\mbox{\hyperlink{main_8c_a667158ed9af1b72bf062e54bda71dd4f}{ADC\_NID}}));}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (!\mbox{\hyperlink{main_8c_a445f79326d40128ece59a749adff6894}{adc\_dev}}) \{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"ADC device\_get\_binding() failed\(\backslash\)n"});}
\DoxyCodeLine{    \} }
\DoxyCodeLine{    err = adc\_channel\_setup(\mbox{\hyperlink{main_8c_a445f79326d40128ece59a749adff6894}{adc\_dev}}, \&my\_channel\_cfg);}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (err) \{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"adc\_channel\_setup() failed with error code \%d\(\backslash\)n"}, err);}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    }
\DoxyCodeLine{ }
\DoxyCodeLine{    NRF\_SAADC-\/>TASKS\_CALIBRATEOFFSET = 1;}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{while}(1) \{}
\DoxyCodeLine{        k\_sem\_take(\&\mbox{\hyperlink{main_8c_a694d4d09f94a0fa64224f38ced19a053}{sem\_a1a}},  K\_FOREVER);}
\DoxyCodeLine{       }
\DoxyCodeLine{        err=adc\_sample();}
\DoxyCodeLine{        \textcolor{keywordflow}{if}(err) \{}
\DoxyCodeLine{            printk(\textcolor{stringliteral}{"adc\_sample() failed with error code \%d\(\backslash\)n\(\backslash\)r"},err);}
\DoxyCodeLine{        \}}
\DoxyCodeLine{        \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{            \textcolor{keywordflow}{if}(adc\_sample\_buffer[0] > 1023) \{}
\DoxyCodeLine{                printk(\textcolor{stringliteral}{"adc reading out of range\(\backslash\)n\(\backslash\)r"});}
\DoxyCodeLine{            \}}
\DoxyCodeLine{            \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{            }
\DoxyCodeLine{                \mbox{\hyperlink{main_8c_a2c9b173c6ea51db9d371f2d06fd8582f}{ab}}=adc\_sample\_buffer[0];}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \}}
\DoxyCodeLine{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Thread A set ab value to: \%d "},\mbox{\hyperlink{main_8c_a2c9b173c6ea51db9d371f2d06fd8582f}{ab}});  }
\DoxyCodeLine{        }
\DoxyCodeLine{        k\_sem\_give(\&\mbox{\hyperlink{main_8c_a82e13125c2f279157fcf738219ff21ba}{sem\_ab}});}
\DoxyCodeLine{       }
\DoxyCodeLine{       }
\DoxyCodeLine{}
\DoxyCodeLine{    \}}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & void $\ast$argA , void $\ast$argB, void $\ast$argC. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns ~\newline
 
\end{DoxyReturn}
\mbox{\Hypertarget{main_8h_a99cef2c8673e9c73162dd97f0247ca8e}\label{main_8h_a99cef2c8673e9c73162dd97f0247ca8e}} 
\index{main.h@{main.h}!thread\_B\_code@{thread\_B\_code}}
\index{thread\_B\_code@{thread\_B\_code}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{thread\_B\_code()}{thread\_B\_code()}}
{\footnotesize\ttfamily void thread\+\_\+\+B\+\_\+code (\begin{DoxyParamCaption}\item[{void $\ast$}]{argA,  }\item[{void $\ast$}]{argB,  }\item[{void $\ast$}]{argC }\end{DoxyParamCaption})}



É efectuada a filtragem, em que é realizado a média das últimas 10 amostras calculadas na Thread A e o filtro rejeita todos os valores que estejam abaixo ou acima de 10\% da média. 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a99cef2c8673e9c73162dd97f0247ca8e}{thread\_B\_code}}(\textcolor{keywordtype}{void} *argA , \textcolor{keywordtype}{void} *argB, \textcolor{keywordtype}{void} *argC)}
\DoxyCodeLine{\{    }
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} Array\_dados[\mbox{\hyperlink{main_8c_a6f1906b9c40734b4c243278466d4ec0b}{len\_dados}}]=\{0\};}
\DoxyCodeLine{    \textcolor{keywordtype}{int} k=0;}
\DoxyCodeLine{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Thread B init (sporadic, waits on a semaphore by task A)\(\backslash\)n"});}
\DoxyCodeLine{    \textcolor{keywordflow}{while}(1) \{}
\DoxyCodeLine{}
\DoxyCodeLine{        \textcolor{keywordtype}{int} sumador=0,somador\_2=0,media=0, media\_filtered=0;}
\DoxyCodeLine{        \textcolor{keywordtype}{int} contador=0;}
\DoxyCodeLine{       }
\DoxyCodeLine{        k\_sem\_take(\&\mbox{\hyperlink{main_8c_a82e13125c2f279157fcf738219ff21ba}{sem\_ab}},  K\_FOREVER);}
\DoxyCodeLine{        }
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Task B read ab value: \%d\(\backslash\)n"},\mbox{\hyperlink{main_8c_a2c9b173c6ea51db9d371f2d06fd8582f}{ab}});}
\DoxyCodeLine{}
\DoxyCodeLine{        \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} k=\mbox{\hyperlink{main_8c_a6f1906b9c40734b4c243278466d4ec0b}{len\_dados}}-\/1; k>0;k-\/-\/)\{}
\DoxyCodeLine{        }
\DoxyCodeLine{        Array\_dados[k]= Array\_dados[k-\/1];}
\DoxyCodeLine{        \}}
\DoxyCodeLine{        Array\_dados[0]= \mbox{\hyperlink{main_8c_a2c9b173c6ea51db9d371f2d06fd8582f}{ab}};}
\DoxyCodeLine{       }
\DoxyCodeLine{       \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < \mbox{\hyperlink{main_8c_a6f1906b9c40734b4c243278466d4ec0b}{len\_dados}}; i++)\{}
\DoxyCodeLine{            \textcolor{keywordflow}{if}(Array\_dados[i] != 0)\{}
\DoxyCodeLine{                sumador = sumador + Array\_dados[i];}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \}}
\DoxyCodeLine{        media=sumador/\mbox{\hyperlink{main_8c_a6f1906b9c40734b4c243278466d4ec0b}{len\_dados}};}
\DoxyCodeLine{        contador=0;}
\DoxyCodeLine{           }
\DoxyCodeLine{        \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j = 0; j < \mbox{\hyperlink{main_8c_a6f1906b9c40734b4c243278466d4ec0b}{len\_dados}}; j++)\{}
\DoxyCodeLine{            \textcolor{keywordflow}{if}(Array\_dados[j] < (media -\/ media*0.1) || Array\_dados[j] > (media + media*0.1))}
\DoxyCodeLine{                somador\_2=somador\_2;}
\DoxyCodeLine{            \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{                somador\_2 = somador\_2 + Array\_dados[j];}
\DoxyCodeLine{                contador =contador +1;}
\DoxyCodeLine{                }
\DoxyCodeLine{            \}             }
\DoxyCodeLine{        \}}
\DoxyCodeLine{}
\DoxyCodeLine{        \textcolor{keywordflow}{if}(somador\_2 != 0)}
\DoxyCodeLine{            media\_filtered=somador\_2/contador;}
\DoxyCodeLine{        \textcolor{keywordflow}{else} }
\DoxyCodeLine{            media\_filtered = 0;}
\DoxyCodeLine{}
\DoxyCodeLine{        \mbox{\hyperlink{main_8c_ab36d1100473c16852c1b64d1917454a4}{bd}}=\mbox{\hyperlink{main_8c_a2c9b173c6ea51db9d371f2d06fd8582f}{ab}};}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Thread B set bc value to: \%d\(\backslash\)n"},\mbox{\hyperlink{main_8c_a97102b52a1cf13a343a1a414bc865cde}{bc}});  }
\DoxyCodeLine{        k\_sem\_give(\&\mbox{\hyperlink{main_8c_a87cd814a87f494b060e8c0903fc0068f}{sem\_bd}});        }
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}
\end{DoxyCode}



\begin{DoxyParams}{Parameters}
{\em arg3} & void $\ast$argA , void $\ast$argB, void $\ast$argC. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
array de dados da adc\mbox{\Hypertarget{main_8h_a6eec62f04743b40b6d744ecd2f31cdd2}\label{main_8h_a6eec62f04743b40b6d744ecd2f31cdd2}} 
\index{main.h@{main.h}!thread\_C\_code@{thread\_C\_code}}
\index{thread\_C\_code@{thread\_C\_code}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{thread\_C\_code()}{thread\_C\_code()}}
{\footnotesize\ttfamily void thread\+\_\+\+C\+\_\+code (\begin{DoxyParamCaption}\item[{void $\ast$}]{argA,  }\item[{void $\ast$}]{argB,  }\item[{void $\ast$}]{argC }\end{DoxyParamCaption})}



Modo manual, onde se faz o toggle sempre que carregar no botão 2 incrementa a luminosidade, ao clicar no botão 4 a luminosidade decrementa, ou seja, diminui a percentagem do P\+WM, quando está a 100\% está no maximo e o duty-\/cycle corresponde é de 0\%, que é quando está no máximo, e assim succesivamente. 


\begin{DoxyCode}{0}
\DoxyCodeLine{ \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a6eec62f04743b40b6d744ecd2f31cdd2}{thread\_C\_code}}(\textcolor{keywordtype}{void} *argA , \textcolor{keywordtype}{void} *argB, \textcolor{keywordtype}{void} *argC)}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{struct }device *\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}};        }
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{struct }device *pwm0\_dev;          }
\DoxyCodeLine{    \textcolor{keywordtype}{int} ret=0;                              }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dcValue[]=\{100,90,80,70,60,50,40,30,20,10,0\};   }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dcIndex=0;   }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pwmPeriod\_us = 100;       }
\DoxyCodeLine{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Thread C init (sporadic, waits on a semaphore by task B)\(\backslash\)n"});}
\DoxyCodeLine{    }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}} = device\_get\_binding(DT\_LABEL(\mbox{\hyperlink{main_8c_a4c0e6f34369bef1deb3a9efae6ac14fb}{GPIO0\_NID}}));}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}} == NULL) \{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Error: Failed to bind to GPIO0\(\backslash\)n\(\backslash\)r"});        }
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{        }
\DoxyCodeLine{    pwm0\_dev = device\_get\_binding(DT\_LABEL(\mbox{\hyperlink{main_8c_ab48b150a8660d0152dfde25b42c1755f}{PWM0\_NID}}));}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (pwm0\_dev == NULL) \{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Error: Failed to bind to PWM0\(\backslash\)n r"});}
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{   }
\DoxyCodeLine{    \textcolor{keywordflow}{while}(1) \{}
\DoxyCodeLine{        k\_sem\_take(\&\mbox{\hyperlink{main_8c_addc907d18e7e98a64a832ac1c7be5ad1}{sem\_bc}}, K\_FOREVER);}
\DoxyCodeLine{        ret=0;}
\DoxyCodeLine{        }
\DoxyCodeLine{}
\DoxyCodeLine{        \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8c_a925968d5fb460a21c13cb8917784b98f}{Flag\_2}}) \{}
\DoxyCodeLine{            dcIndex++;}
\DoxyCodeLine{            \textcolor{keywordflow}{if}(dcIndex == 11) }
\DoxyCodeLine{                dcIndex = 0;}
\DoxyCodeLine{            \mbox{\hyperlink{main_8c_a925968d5fb460a21c13cb8917784b98f}{Flag\_2}} = 0;}
\DoxyCodeLine{            printk(\textcolor{stringliteral}{"PWM DC value set to \%u \%\%\(\backslash\)n\(\backslash\)r"},dcValue[dcIndex]);}
\DoxyCodeLine{}
\DoxyCodeLine{            ret = pwm\_pin\_set\_usec(pwm0\_dev, \mbox{\hyperlink{main_8c_ad66f6c0ce6fd44d24653df422e7a8c92}{BOARDLED1}},}
\DoxyCodeLine{              pwmPeriod\_us,(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})((pwmPeriod\_us*dcValue[dcIndex])/100), PWM\_POLARITY\_NORMAL);}
\DoxyCodeLine{            \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{                printk(\textcolor{stringliteral}{"Error \%d: failed to set pulse width\(\backslash\)n"}, ret);}
\DoxyCodeLine{        \textcolor{keywordflow}{return};}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \} }
\DoxyCodeLine{        \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8c_a9797c6a281fed7356c07f50a6727bd88}{Flag\_4}}) \{}
\DoxyCodeLine{            }
\DoxyCodeLine{            \textcolor{keywordflow}{if}(dcIndex == 0) }
\DoxyCodeLine{                dcIndex = 11;}
\DoxyCodeLine{            dcIndex-\/-\/;}
\DoxyCodeLine{            \mbox{\hyperlink{main_8c_a9797c6a281fed7356c07f50a6727bd88}{Flag\_4}} = 0;}
\DoxyCodeLine{            printk(\textcolor{stringliteral}{"PWM DC value set to \%u \%\%\(\backslash\)n\(\backslash\)r"},dcValue[dcIndex]);}
\DoxyCodeLine{}
\DoxyCodeLine{            ret = pwm\_pin\_set\_usec(pwm0\_dev, \mbox{\hyperlink{main_8c_ad66f6c0ce6fd44d24653df422e7a8c92}{BOARDLED1}},}
\DoxyCodeLine{              pwmPeriod\_us,(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})((pwmPeriod\_us*dcValue[dcIndex])/100), PWM\_POLARITY\_NORMAL);}
\DoxyCodeLine{            \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{                printk(\textcolor{stringliteral}{"Error \%d: failed to set pulse width\(\backslash\)n"}, ret);}
\DoxyCodeLine{        \textcolor{keywordflow}{return};}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \}}
\DoxyCodeLine{                       }
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Task C -\/ PWM: \%u \% n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})(((pwmPeriod\_us*\mbox{\hyperlink{main_8c_a97102b52a1cf13a343a1a414bc865cde}{bc}})/1023)/10)); }
\DoxyCodeLine{    \}}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em arg3} & void $\ast$argA , void $\ast$argB, void $\ast$argC. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
No returns 
\end{DoxyReturn}
Prints dutty-\/cycle\mbox{\Hypertarget{main_8h_a66dec4e923ae4b8177536366d462a1cd}\label{main_8h_a66dec4e923ae4b8177536366d462a1cd}} 
\index{main.h@{main.h}!thread\_D\_code@{thread\_D\_code}}
\index{thread\_D\_code@{thread\_D\_code}!main.h@{main.h}}
\doxysubsubsection{\texorpdfstring{thread\_D\_code()}{thread\_D\_code()}}
{\footnotesize\ttfamily void thread\+\_\+\+D\+\_\+code (\begin{DoxyParamCaption}\item[{void $\ast$}]{argA,  }\item[{void $\ast$}]{argB,  }\item[{void $\ast$}]{argC }\end{DoxyParamCaption})}



Modo automático\+: Recebe o valor da A\+DC e faz o take que vem do bd (após a filtragem); Se o valor for menor que 500, o led está apagado, ou seja, é detetada muita luminiosidade logo; Quando estamos à luz ambiente o led está com a luminiosidade a meio; Se não existir luminiosidade o led acede. 


\begin{DoxyCode}{0}
\DoxyCodeLine{ \textcolor{keywordtype}{void} \mbox{\hyperlink{main_8c_a1a621f0dfdf57a438495482f571278e7}{thread\_D\_code}}(\textcolor{keywordtype}{void} *argA , \textcolor{keywordtype}{void} *argB, \textcolor{keywordtype}{void} *argC)}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{struct }device *\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}};        }
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{struct }device *pwm0\_dev;          }
\DoxyCodeLine{    \textcolor{keywordtype}{int} ret=0;                              }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dcValue[]=\{100,90,80,70,60,50,40,30,20,10,0\};   }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dcIndex=0;   }
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pwmPeriod\_us = 100;       }
\DoxyCodeLine{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Thread C init (sporadic, waits on a semaphore by task B)\(\backslash\)n"});}
\DoxyCodeLine{    }
\DoxyCodeLine{    }
\DoxyCodeLine{    \mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}} = device\_get\_binding(DT\_LABEL(\mbox{\hyperlink{main_8c_a4c0e6f34369bef1deb3a9efae6ac14fb}{GPIO0\_NID}}));}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (\mbox{\hyperlink{main_8c_ac8529dec83e91f71d383fb84302cfb27}{gpio0\_dev}} == NULL) \{}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Error: Failed to bind to GPIO0\(\backslash\)n\(\backslash\)r"});        }
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{        }
\DoxyCodeLine{    pwm0\_dev = device\_get\_binding(DT\_LABEL(\mbox{\hyperlink{main_8c_ab48b150a8660d0152dfde25b42c1755f}{PWM0\_NID}}));}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (pwm0\_dev == NULL) \{}
\DoxyCodeLine{    printk(\textcolor{stringliteral}{"Error: Failed to bind to PWM0\(\backslash\)n r"});}
\DoxyCodeLine{    \textcolor{keywordflow}{return};}
\DoxyCodeLine{    \}}
\DoxyCodeLine{   }
\DoxyCodeLine{    \textcolor{keywordflow}{while}(1) \{}
\DoxyCodeLine{        k\_sem\_take(\&\mbox{\hyperlink{main_8c_a87cd814a87f494b060e8c0903fc0068f}{sem\_bd}}, K\_FOREVER);}
\DoxyCodeLine{        printk(\textcolor{stringliteral}{"Valor lido para automatico \%d\(\backslash\)n r"},\mbox{\hyperlink{main_8c_ab36d1100473c16852c1b64d1917454a4}{bd}});}
\DoxyCodeLine{        ret=0;}
\DoxyCodeLine{        }
\DoxyCodeLine{}
\DoxyCodeLine{        \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8c_ab36d1100473c16852c1b64d1917454a4}{bd}}<500) \{}
\DoxyCodeLine{            }
\DoxyCodeLine{            ret = pwm\_pin\_set\_usec(pwm0\_dev, \mbox{\hyperlink{main_8c_ad66f6c0ce6fd44d24653df422e7a8c92}{BOARDLED1}},}
\DoxyCodeLine{              pwmPeriod\_us,(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})(pwmPeriod\_us), PWM\_POLARITY\_NORMAL);}
\DoxyCodeLine{            \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{                printk(\textcolor{stringliteral}{"Error \%d: failed to set pulse width\(\backslash\)n"}, ret);}
\DoxyCodeLine{        \textcolor{keywordflow}{return};}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \} }
\DoxyCodeLine{        \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{            }
\DoxyCodeLine{            ret = pwm\_pin\_set\_usec(pwm0\_dev, \mbox{\hyperlink{main_8c_ad66f6c0ce6fd44d24653df422e7a8c92}{BOARDLED1}},}
\DoxyCodeLine{              pwmPeriod\_us,(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})(0), PWM\_POLARITY\_NORMAL);}
\DoxyCodeLine{            \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{                printk(\textcolor{stringliteral}{"Error \%d: failed to set pulse width\(\backslash\)n"}, ret);}
\DoxyCodeLine{        \textcolor{keywordflow}{return};}
\DoxyCodeLine{            \}}
\DoxyCodeLine{        \} }
\DoxyCodeLine{        }
\DoxyCodeLine{ \}}
\DoxyCodeLine{ \}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em N\+O\+\_\+args} & without arguments \\
\hline
{\em arg3} & void $\ast$argA , void $\ast$argB, void $\ast$argC.\\
\hline
\end{DoxyParams}
Takes one adc\+\_\+sample 
\begin{DoxyCode}{0}
\DoxyCodeLine{  \textcolor{keyword}{static} \textcolor{keywordtype}{int} adc\_sample(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keywordtype}{int} ret;}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{struct }adc\_sequence sequence = \{}
\DoxyCodeLine{        .channels = BIT(\mbox{\hyperlink{main_8c_a8bfca74ee546715af6682194ea92286a}{ADC\_CHANNEL\_ID}}),}
\DoxyCodeLine{        .buffer = adc\_sample\_buffer,}
\DoxyCodeLine{        .buffer\_size = \textcolor{keyword}{sizeof}(adc\_sample\_buffer),}
\DoxyCodeLine{        .resolution = \mbox{\hyperlink{main_8c_a00978ca9e8220475258dcbbbb7d29129}{ADC\_RESOLUTION}},}
\DoxyCodeLine{    \};}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (\mbox{\hyperlink{main_8c_a445f79326d40128ece59a749adff6894}{adc\_dev}} == NULL) \{}
\DoxyCodeLine{            printk(\textcolor{stringliteral}{"adc\_sample(): error, must bind to adc first \(\backslash\)r"});}
\DoxyCodeLine{            \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{    \}}
\DoxyCodeLine{}
\DoxyCodeLine{    ret = adc\_read(\mbox{\hyperlink{main_8c_a445f79326d40128ece59a749adff6894}{adc\_dev}}, \&sequence);}
\DoxyCodeLine{    \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{            printk(\textcolor{stringliteral}{"adc\_read() failed with code \%d\(\backslash\)n"}, ret);}
\DoxyCodeLine{    \}   }
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{\}}
\end{DoxyCode}
 
\begin{DoxyParams}{Parameters}
{\em N\+O\+\_\+args} & without arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Read A\+D\+C\+\_\+sample value (static int) 
\end{DoxyReturn}
